<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple PDF Viewer</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        #pdf-viewer {
            width: 100%;
            height: 100vh;
            display: block;
        }

        .error-container {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
            text-align: center;
        }

        .error-container h1 {
            color: #e53e3e;
            margin-bottom: 1rem;
        }

        .btn {
            display: inline-block;
            background-color: #3182ce;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            margin-top: 20px;
            font-size: 16px;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3182ce;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading PDF...</p>
    </div>

    <iframe id="pdf-viewer" style="display:none;"></iframe>

    <div id="error-container" class="error-container" style="display:none;">
        <h1>Error loading PDF</h1>
        <p id="error-message">The PDF file could not be loaded.</p>
        <a id="home-link" href="/" class="btn">Return to Home</a>
    </div>

    <script>
        // Get the filename from the URL query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const filename = urlParams.get('file');

        if (!filename) {
            showError('No filename specified');
        } else {
            const pdfUrl = `/api/serve-cv/${encodeURIComponent(filename)}`;

            // Set the document title
            document.title = `PDF Viewer - ${decodeURIComponent(filename)}`;

            // Check if the file exists before trying to display it
            fetch(pdfUrl, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        const viewer = document.getElementById('pdf-viewer');
                        viewer.src = pdfUrl;
                        viewer.onload = function () {
                            document.getElementById('loading').style.display = 'none';
                            viewer.style.display = 'block';
                        };

                        // Set a timeout in case the onload event doesn't fire
                        setTimeout(function () {
                            if (document.getElementById('loading').style.display !== 'none') {
                                document.getElementById('loading').style.display = 'none';
                                viewer.style.display = 'block';
                            }
                        }, 3000);
                    } else {
                        showError(`File not found (${response.status})`);
                    }
                })
                .catch(error => {
                    showError(`Error checking file: ${error.message}`);
                });
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-container').style.display = 'flex';
            document.getElementById('error-message').textContent = message;
        }
    </script>
</body>

</html>